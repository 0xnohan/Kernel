{% extends 'base.html' %}
{% block title %} Transaction Details {% endblock %}

{% block content %}
<div class="page-container tx-details-page">

  <h1 class="page-title">Transaction</h1>

  <section class="card data-card transaction-summary-card">
    <header class="card-header">
      <h2 class="transaction-id font-mono">{{ Tx['TxId'] }}</h2>
    </header>
    <div class="card-body">
      <dl class="definition-list grid">
        <div class="definition-item">
          <dt>Status</dt>
          <dd>
            {% if Unconfirmed %}
              <span class="chip chip-warning">Unconfirmed</span>
            {% else %}
              <span class="chip chip-success">Confirmed</span>
              {% if block %}
                in block <a href="{{ url_for('block', blockHeader=block['BlockHeader']['blockHash']) }}">{{ block['Height'] }}</a>
              {% endif %}
            {% endif %}
          </dd>
        </div>

        <div class="definition-item">
            <dt>Fee</dt>
            <dd>0.25 KNL</dd> 
        </div>
         <div class="definition-item">
            <dt>Size</dt>
            <dd>Unknown bytes</dd> 
        </div>
        <div class="definition-item">
            <dt>Version</dt>
            <dd class="font-mono">{{ Tx['version'] }}</dd>
        </div>
         <div class="definition-item">
            <dt>Locktime</dt>
            <dd>{{ Tx['locktime'] }}</dd>
        </div>

      </dl>
    </div>
  </section>

  <section class="card data-card transaction-io-card">
     <div class="card-body transaction-io">
        <div class="tx-inputs">
            <h4>Inputs</h4>
            <ul class="tx-io-list">
              {% for tx_in in Tx['tx_ins'] %}
                <li>
                  {% if tx_in['prev_tx']=='0000000000000000000000000000000000000000000000000000000000000000' %}
                    <span class="coinbase-input"><span class="io-index">#{{ loop.index0 }}</span> Coinbase</span>
                  {% else %}
                     <span class="input-item font-mono">
                         <span class="io-index">#{{ loop.index0 }}</span> From: <a href="{{ url_for('transactions', txid=tx_in['prev_tx']) }}" title="{{ tx_in['prev_tx'] }}">...{{ tx_in['prev_tx'][-12:] }}</a>
                     </span>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          </div>

          <div class="tx-outputs">
            <h4>Outputs</h4>
            <ul class="tx-io-list">
              {% for tx_out in Tx['tx_outs'] %}
                {% set h160hash = bytes.fromhex(tx_out['script_pubkey']['cmds'][2]) %}
                {% set newAddr = main_prefix + h160hash %}
                {% set checksum = sha256(sha256(newAddr).digest()).digest()[:4] %}
                {% set newAddr = newAddr + checksum %}
                {% set pubAddress = encode_base58(newAddr) %}
                {% if (tx_out['amount']%100000000) == 0 %}
                  {% set amount = (tx_out['amount']/100000000)|round()|int %}
                {% else %}
                  {% set amount = tx_out['amount']/100000000 %}
                {% endif %}
                <li>
                  <a href="{{ url_for('address', publicAddress = pubAddress) }}" class="output-link">
                    <span class="io-index">#{{ loop.index0 }}</span>
                    <span class="output-address font-mono">{{ pubAddress }}</span>
                    <span class="output-amount">{{ amount }} KNL</span>
                  </a>
                </li>
              {% endfor %}
            </ul>
          </div>
      </div> 
  </section>

</div> 
{%endblock%}