{% extends 'base.html' %}
{% block title %}Wallet{% endblock %}

{% block content %}

<div class="wallet-container" style="display: flex; gap: var(--spacing-xl); align-items: flex-start; max-width: 20000px; margin: 2em auto;">
    <div class="wallet-column" style="flex: 2; min-width: 0;">
        <section class="card data-card">
            <header class="card-header">
                <h1 class="card-title">My Wallets</h1>
                <form action="{{ url_for('wallet') }}" method="post" style="margin: 0;">
                    <input type="hidden" name="action" value="create">
                    <button type="submit" class="button">Create New Wallet</button>
                </form>
            </header>
            <div class="card-body no-padding">
                {% if wallets %}
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Public Address</th>
                                <th>Private Key</th>
                                <th class="cell-numeric">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for wallet in wallets %}
                            <tr>
                                <td data-label="Address" class="cell-hash">
                                    <a href="{{ url_for('address', publicAddress=wallet.PublicAddress) }}">{{ wallet.PublicAddress }}</a>
                                </td>
                                <td data-label="Private Key">
                                    <span class="font-mono" 
                                          style="color: var(--color-accent-error); cursor: pointer; text-decoration: underline;" 
                                          title="Copy Private Key to clipboard"
                                          onclick="navigator.clipboard.writeText('{{ wallet.privateKey }}'); this.textContent='Copied!'; setTimeout(() => { this.textContent='Copy to clipboard' }, 2000);">
                                        Copy to clipboard
                                    </span>
                                </td>
                                <td data-label="Actions" class="cell-numeric">
                                    <form action="{{ url_for('wallet') }}" method="post" style="display: inline;">
                                        <input type="hidden" name="action" value="delete">
                                        <input type="hidden" name="publicAddress" value="{{ wallet.PublicAddress }}">
                                        <button type="submit" class="button button-outline" style="--color-accent-error: #f28b82;" onclick="return confirm('Are you sure you want to delete this wallet ? This action is irreversible')">Delete</button>
                                    </form>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <p class="no-data-message">No wallets found</p>
                {% endif %}
            </div>
        </section>
    </div>

    <div class="wallet-column" style="flex: 1; min-width: 0;">
        <section class="card form-card wallet-card"> 
          <header class="card-header">
              <h1 class="card-title">Send Transaction</h1>
          </header>
          <div class="card-body">
            <form action="{{ url_for('wallet') }}" id="send-form" method="post">
              <input type="hidden" name="action" value="send">

              <div class="form-group">
                <label for="from">From Address</label>
                {% if wallets %}
                <select id="from" name="fromAddress" class="form-input font-mono" required>
                    <option value="" disabled selected>Select a wallet </option>
                    {% for wallet in wallets %}
                        <option value="{{ wallet.PublicAddress }}">{{ wallet.PublicAddress }}</option>
                    {% endfor %}
                </select>
                {% else %}
                <input type="text" id="from" name="fromAddress" class="form-input font-mono" placeholder="Your sending address" required />
                {% endif %}
              </div>

              <div class="form-group">
                <label for="to">To Address</label>
                <input type="text" id="to" name="toAddress" class="form-input font-mono" placeholder="Recipient's address" required />
              </div>

              <div class="form-group">
                <label for="amount">Amount (KNL)</label>
                <input type="number" id="amount" name="Amount" class="form-input" placeholder="0.00000000" step="any" min="0" required /> 
              </div>

              {% if message %}
              <div class="form-message" role="alert"> 
                <span>{{ message }}</span>
              </div>
              {% endif %}

              <div class="form-actions">
                <button type="submit" class="button button-primary">Send Transaction</button>
              </div>
            </form>
          </div>
        </section>
    </div>

</div>
{% endblock %}